<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–æ–≤–∞—Ä–∞–º–∏ - iStore Admin</title>
    <link rel="stylesheet" href="admin-products.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* –í—Å–µ –≤–∞—à–∏ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        .users-section { display: none; }
        .users-section.active { display: block; }
        .users-table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .users-table th, .users-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #e1e1e1; }
        .users-table th { background: #f8f9fa; font-weight: bold; color: #333; }
        .user-status { padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; }
        .status-active { background: #d4edda; color: #155724; }
        .status-blocked { background: #f8d7da; color: #721c24; }
        .status-admin { background: #cce7ff; color: #004085; }
        .user-actions { display: flex; gap: 5px; }
        .user-btn { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; transition: all 0.3s; }
        .user-btn.block { background: #e53935; color: white; }
        .user-btn.unblock { background: #4CAF50; color: white; }
        .user-btn.admin { background: #007aff; color: white; }
        .user-btn.history { background: #ffa000; color: white; }
        .user-btn.password { background: #9c27b0; color: white; }
        .user-btn:hover { opacity: 0.8; transform: translateY(-1px); }
        .empty-users { text-align: center; padding: 40px 20px; color: #666; }
        .empty-users i { font-size: 48px; margin-bottom: 15px; opacity: 0.5; }
        .admin-tabs { display: flex; margin-bottom: 20px; border-bottom: 2px solid #f0f0f0; }
        .admin-tab { padding: 12px 20px; cursor: pointer; border-bottom: 3px solid transparent; font-weight: 500; transition: all 0.3s; }
        .admin-tab.active { border-bottom-color: #007aff; color: #007aff; }

        /* –°—Ç–∏–ª—ñ –¥–ª—è —á–∞—Ç—É –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ */
        .support-chat-section { display: none; }
        .support-chat-section.active { display: block; }
        .support-chat-layout { display: grid; grid-template-columns: 350px 1fr; gap: 20px; height: 600px; }
        .chat-users-list { background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow-y: auto; }
        .chat-user-item { padding: 15px 20px; border-bottom: 1px solid #e1e1e1; cursor: pointer; transition: all 0.3s; display: flex; justify-content: space-between; align-items: flex-start; }
        .chat-user-item:hover { background: #f8f9fa; }
        .chat-user-item.active { background: #007aff; color: white; }
        .chat-user-info { display: flex; flex-direction: column; flex: 1; }
        .chat-user-name { font-weight: bold; margin-bottom: 5px; }
        .chat-user-last-message { font-size: 12px; color: #666; opacity: 0.8; line-height: 1.3; }
        .chat-user-item.active .chat-user-last-message { color: white; }
        .chat-user-meta { display: flex; flex-direction: column; align-items: flex-end; gap: 5px; }
        .chat-user-time { font-size: 11px; color: #999; white-space: nowrap; }
        .chat-user-item.active .chat-user-time { color: white; }
        .unread-badge { background: #e53935; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold; }
        .admin-chat-container { background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; flex-direction: column; height: 100%; }
        .admin-chat-header { padding: 20px; border-bottom: 1px solid #e1e1e1; background: #f8f9fa; border-radius: 8px 8px 0 0; min-height: 80px; display: flex; align-items: center; }
        .selected-chat-info h3 { margin: 0 0 5px 0; color: #333; }
        .selected-chat-info p { margin: 0; color: #666; font-size: 14px; }
        .admin-chat-messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; background: #f8f9fa; }
        .admin-message { max-width: 70%; padding: 12px 16px; border-radius: 15px; position: relative; animation: fadeIn 0.3s ease-out; line-height: 1.4; }
        .admin-message.user { align-self: flex-start; background: white; color: #333; border: 1px solid #e1e1e1; border-bottom-left-radius: 5px; }
        .admin-message.agent { align-self: flex-end; background: #007aff; color: white; border-bottom-right-radius: 5px; }
        .admin-message-time { font-size: 11px; opacity: 0.7; margin-top: 5px; }
        .admin-message.user .admin-message-time { text-align: left; }
        .admin-message.agent .admin-message-time { text-align: right; }
        .admin-chat-input-container { padding: 20px; border-top: 1px solid #e1e1e1; }
        .admin-chat-input-wrapper { display: flex; gap: 10px; align-items: flex-end; }
        .admin-chat-input { flex: 1; padding: 12px 16px; border: 2px solid #e1e1e1; border-radius: 25px; resize: none; font-size: 14px; transition: border-color 0.3s; max-height: 120px; min-height: 50px; font-family: inherit; }
        .admin-chat-input:focus { border-color: #007aff; outline: none; }
        .admin-send-btn { background: #007aff; color: white; border: none; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; font-size: 16px; }
        .admin-send-btn:hover { background: #0056cc; transform: scale(1.05); }
        .admin-send-btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .no-chat-selected { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; color: #666; text-align: center; padding: 40px; }
        .no-chat-selected i { font-size: 64px; margin-bottom: 20px; opacity: 0.5; }
        .no-chat-selected h3 { margin: 0 0 10px 0; font-size: 18px; }
        .no-chat-selected p { margin: 0; font-size: 14px; line-height: 1.4; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ä–æ–∑—ñ–≥—Ä–∞—à–µ–º */
        .giveaway-management { background: white; border-radius: 12px; padding: 30px; box-shadow: 0 2px 15px rgba(0,0,0,0.1); }
        .giveaway-preview { background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #8e44ad 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; text-align: center; position: relative; overflow: hidden; min-height: 200px; display: flex; align-items: center; justify-content: center; }
        .giveaway-preview-content { position: relative; z-index: 2; }
        .giveaway-preview-title { font-size: 2rem; font-weight: bold; margin-bottom: 15px; }
        .giveaway-preview-date { font-size: 1.5rem; font-weight: bold; background: rgba(255,255,255,0.2); padding: 10px 20px; border-radius: 10px; display: inline-block; }
        .giveaway-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }
        .giveaway-control-group { display: flex; flex-direction: column; gap: 10px; }
        .giveaway-control-group label { font-weight: bold; color: #333; display: flex; align-items: center; gap: 8px; }
        .giveaway-date-input { padding: 12px 15px; border: 2px solid #e1e1e1; border-radius: 8px; font-size: 16px; transition: border-color 0.3s; }
        .giveaway-date-input:focus { border-color: #007aff; outline: none; }
        .image-upload-giveaway { border: 2px dashed #007aff; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s; background: #f8f9fa; }
        .image-upload-giveaway:hover { background: #e9ecef; border-color: #0056cc; }
        .image-upload-giveaway i { font-size: 48px; color: #007aff; margin-bottom: 10px; }
        .current-banner-info { margin-top: 15px; padding: 15px; background: #e7f3ff; border-radius: 8px; border-left: 4px solid #007aff; }
        .current-banner-info h4 { margin: 0 0 8px 0; color: #007aff; }
        .current-banner-info p { margin: 0; color: #666; font-size: 14px; }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –ø—Ä–∏–∑—ñ–≤ */
        .prizes-management { margin-top: 30px; padding-top: 25px; border-top: 2px solid #f0f0f0; }
        .prize-item-control { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #e1e1e1; }
        .prize-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .prize-item-control h4 { margin: 0; color: #333; display: flex; align-items: center; gap: 10px; }
        .prize-type-badge { background: #007aff; color: white; padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: bold; }
        .prize-type-main { background: #ff6b6b; }
        .prize-controls-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .prize-control-group { display: flex; flex-direction: column; gap: 8px; }
        .prize-control-group label { font-weight: 500; color: #555; font-size: 14px; }
        .prize-input { padding: 10px 12px; border: 2px solid #e1e1e1; border-radius: 6px; font-size: 14px; transition: border-color 0.3s; }
        .prize-input:focus { border-color: #007aff; outline: none; }
        .prize-description { grid-column: 1 / -1; }
        .prize-description textarea { width: 100%; min-height: 80px; resize: vertical; }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å –¥–ª—è —á–∞—Ç—É */
        @media (max-width: 1024px) {
            .support-chat-layout { grid-template-columns: 1fr; height: auto; }
            .chat-users-list { max-height: 250px; }
            .admin-chat-container { height: 500px; }
            .giveaway-controls { grid-template-columns: 1fr; }
            .prize-controls-grid { grid-template-columns: 1fr; }
        }
        
        @media (max-width: 768px) {
            .support-chat-layout { gap: 15px; }
            .admin-message { max-width: 85%; }
            .chat-user-item { padding: 12px 15px; }
            .giveaway-management { padding: 20px; }
            .giveaway-preview { padding: 20px; }
            .giveaway-preview-title { font-size: 1.5rem; }
            .giveaway-preview-date { font-size: 1.2rem; }
        }
        
        @media (max-width: 480px) {
            .admin-message { max-width: 90%; padding: 10px 14px; }
            .admin-chat-messages { padding: 15px; }
            .admin-chat-input-container { padding: 15px; }
            .giveaway-preview { padding: 15px; min-height: 150px; }
        }
    </style>
</head>
<body>
    <div class="products-admin-container">
        <!-- Header -->
        <header class="products-header">
            <div class="header-left">
                <h1>üì¶ –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–æ–≤–∞—Ä–∞–º–∏</h1>
                <span class="products-count" id="products-count">0 —Ç–æ–≤–∞—Ä—ñ–≤</span>
            </div>
            <div class="header-right">
                <button class="btn btn-primary" onclick="openAddProductModal()">
                    <i class="fas fa-plus"></i>
                    –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä
                </button>
                <button class="btn btn-secondary" onclick="exportProducts()">
                    <i class="fas fa-download"></i>
                    –ï–∫—Å–ø–æ—Ä—Ç
                </button>
                <button class="btn btn-success" onclick="syncWithMainSite()">
                    <i class="fas fa-sync"></i>
                    –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏
                </button>
            </div>
        </header>

        <!-- Admin Tabs -->
        <div class="admin-tabs">
            <div class="admin-tab active" onclick="switchAdminTab('products')">–¢–æ–≤–∞—Ä–∏</div>
            <div class="admin-tab" onclick="switchAdminTab('users')">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</div>
            <div class="admin-tab" onclick="switchAdminTab('support-chat')">–ß–∞—Ç –ø—ñ–¥—Ç—Ä–∏–º–∫–∏</div>
            <div class="admin-tab" onclick="switchAdminTab('giveaway')">–†–æ–∑—ñ–≥—Ä–∞—à</div>
        </div>

        <!-- Products Section -->
        <div class="products-section active" id="products-section">
            <!-- Filters -->
            <div class="products-filters">
                <div class="filter-group">
                    <input type="text" id="search-products" placeholder="üîç –ü–æ—à—É–∫ —Ç–æ–≤–∞—Ä—ñ–≤..." oninput="filterProducts()">
                </div>
                <div class="filter-group">
                    <select id="category-filter" onchange="filterProducts()">
                        <option value="">–í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</option>
                        <option value="iphone">iPhone</option>
                        <option value="ipad">iPad</option>
                        <option value="macbook">MacBook</option>
                        <option value="apple-watch">Apple Watch</option>
                    </select>
                </div>
                <div class="filter-group">
                    <select id="status-filter" onchange="filterProducts()">
                        <option value="">–í—Å—ñ —Å—Ç–∞—Ç—É—Å–∏</option>
                        <option value="in-stock">–í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ</option>
                        <option value="out-of-stock">–ù–µ–º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ</option>
                    </select>
                </div>
            </div>

            <!-- Products Grid -->
            <div class="products-grid" id="products-grid">
                <!-- –¢–æ–≤–∞—Ä–∏ –±—É–¥—É—Ç—å –¥–æ–¥–∞–≤–∞—Ç–∏—Å—å —Ç—É—Ç -->
            </div>
        </div>

        <!-- Users Section -->
        <div class="users-section" id="users-section">
            <div class="products-filters">
                <div class="filter-group">
                    <input type="text" id="search-users" placeholder="üîç –ü–æ—à—É–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤..." oninput="filterUsers()">
                </div>
                <div class="filter-group">
                    <select id="status-users-filter" onchange="filterUsers()">
                        <option value="">–í—Å—ñ —Å—Ç–∞—Ç—É—Å–∏</option>
                        <option value="active">–ê–∫—Ç–∏–≤–Ω—ñ</option>
                        <option value="blocked">–ó–∞–±–ª–æ–∫–æ–≤–∞–Ω—ñ</option>
                        <option value="admin">–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∏</option>
                    </select>
                </div>
            </div>

            <div class="users-container">
                <table class="users-table" id="users-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–Ü–º'—è</th>
                            <th>Email</th>
                            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                            <th>–ü–∞—Ä–æ–ª—å</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–∞—Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó</th>
                            <th>–î—ñ—ó</th>
                        </tr>
                    </thead>
                    <tbody id="users-table-body">
                        <!-- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ —Ç—É—Ç -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Support Chat Section -->
        <div class="support-chat-section" id="support-chat-section">
            <div class="support-chat-layout">
                <div class="chat-users-list" id="chat-users-list">
                    <!-- –°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ –∞–∫—Ç–∏–≤–Ω–∏–º–∏ —á–∞—Ç–∞–º–∏ -->
                </div>
                
                <div class="admin-chat-container">
                    <div class="admin-chat-header" id="admin-chat-header">
                        <div class="no-chat-selected" id="no-chat-selected">
                            <i class="fas fa-comments"></i>
                            <h3>–û–±–µ—Ä—ñ—Ç—å —á–∞—Ç –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É</h3>
                            <p>–í–∏–±–µ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑—ñ —Å–ø–∏—Å–∫—É, —â–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –Ω–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</p>
                        </div>
                        <div class="selected-chat-info" id="selected-chat-info" style="display: none;">
                            <h3 id="selected-user-name">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á</h3>
                            <p id="selected-user-status">–û–Ω–ª–∞–π–Ω</p>
                        </div>
                    </div>
                    
                    <div class="admin-chat-messages" id="admin-chat-messages">
                        <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –±—É–¥—É—Ç—å –¥–æ–¥–∞–≤–∞—Ç–∏—Å—å —Ç—É—Ç -->
                    </div>
                    
                    <div class="admin-chat-input-container" id="admin-chat-input-container" style="display: none;">
                        <div class="admin-chat-input-wrapper">
                            <textarea 
                                class="admin-chat-input" 
                                id="admin-message-input" 
                                placeholder="–í–≤–µ–¥—ñ—Ç—å –≤–∞—à—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å..."
                                rows="1"
                            ></textarea>
                            <button class="admin-send-btn" id="admin-send-btn" onclick="sendAdminMessage()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Giveaway Management Section -->
        <div class="support-chat-section" id="giveaway-section">
            <div class="giveaway-management">
                <div class="section-header">
                    <h2><i class="fas fa-gift"></i> –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ä–æ–∑—ñ–≥—Ä–∞—à–µ–º</h2>
                    <p>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–∞–Ω–µ—Ä–∞ —Ä–æ–∑—ñ–≥—Ä–∞—à—É –Ω–∞ –≥–æ–ª–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ</p>
                </div>

                <!-- Preview -->
                <div class="giveaway-preview" id="giveaway-preview">
                    <div class="giveaway-preview-content">
                        <div class="store-logo" id="preview-store-logo">i<span>Market Sell</span></div>
                        <div class="giveaway-preview-title" id="preview-title">üéâ –†–û–ó–Ü–ì–†–ê–® –í–Ü–î iMarket Sell!</div>
                        <p class="giveaway-subtitle" id="preview-subtitle">
                            üéß –ó–∞—Ä–µ—î—Å—Ç—Ä—É–π –∞–∫–∞—É–Ω—Ç ‚Äî —ñ –≤–∂–µ –±–µ—Ä–µ—à —É—á–∞—Å—Ç—å —É —Ä–æ–∑—ñ–≥—Ä–∞—à—ñ –Ω–∞–≤—É—à–Ω–∏–∫—ñ–≤ Apple!<br>
                            üì± –ó—Ä–æ–±–∏ –ø–æ–∫—É–ø–∫—É ‚Äî —ñ –æ—Ç—Ä–∏–º–∞–π —à–∞–Ω—Å –≤–∏–≥—Ä–∞—Ç–∏ –Ω–æ–≤–µ–Ω—å–∫–∏–π iPhone 15 Pro Max!
                        </p>
                        
                        <div class="prize-section" id="preview-prizes">
                            <div class="prize-item">
                                <div class="prize-icon">üéß</div>
                                <div class="prize-name" id="preview-secondary-prize-name">AirPods Pro</div>
                                <div class="prize-condition" id="preview-secondary-prize-condition">–ó–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é</div>
                            </div>
                            <div class="prize-item main-prize">
                                <div class="prize-icon">üì±</div>
                                <div class="prize-name" id="preview-main-prize-name">iPhone 15 Pro Max</div>
                                <div class="prize-condition" id="preview-main-prize-condition">–ó–∞ –ø–æ–∫—É–ø–∫—É</div>
                            </div>
                        </div>

                        <div class="giveaway-timer">
                            <div class="timer-title">
                                <i class="fas fa-clock"></i>
                                –†–æ–∑—ñ–≥—Ä–∞—à –≤—ñ–¥–±—É–¥–µ—Ç—å—Å—è
                            </div>
                            <div class="timer-numbers" id="preview-date">27.11.2024</div>
                        </div>

                        <button class="giveaway-cta">
                            <i class="fas fa-ticket-alt"></i>
                            –£–ß–ê–°–¢–¨ –£ –†–û–ó–Ü–ì–†–ê–®–Ü
                        </button>
                        
                        <div class="participants-count">
                            <i class="fas fa-users"></i>
                            –í–∂–µ –±–µ—Ä—É—Ç—å —É—á–∞—Å—Ç—å: <strong id="preview-participants">2,458</strong> –æ—Å—ñ–±
                        </div>
                    </div>
                </div>

                <!-- Controls -->
                <div class="giveaway-controls">
                    <div class="giveaway-control-group">
                        <label>
                            <i class="fas fa-calendar-alt"></i>
                            –î–∞—Ç–∞ —Ä–æ–∑—ñ–≥—Ä–∞—à—É:
                        </label>
                        <input type="date" id="giveaway-date" class="giveaway-date-input" onchange="updateGiveawayPreview()">
                    </div>
                    
                    <div class="giveaway-control-group">
                        <label>
                            <i class="fas fa-image"></i>
                            –§–æ–Ω –±–∞–Ω–µ—Ä–∞:
                        </label>
                        <div class="image-upload-giveaway" onclick="document.getElementById('banner-image').click()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–æ—Ç–æ</p>
                            <small>–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π —Ä–æ–∑–º—ñ—Ä: 1200x400px</small>
                        </div>
                        <input type="file" id="banner-image" accept="image/*" style="display: none;" onchange="handleBannerUpload(event)">
                    </div>
                </div>

                <!-- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∏–∑—ñ–≤ -->
                <div class="prizes-management">
                    <h3><i class="fas fa-trophy"></i> –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∏–∑—ñ–≤</h3>
                    
                    <div class="prize-item-control">
                        <div class="prize-item-header">
                            <h4><i class="fas fa-gift"></i> –ì–æ–ª–æ–≤–Ω–∏–π –ø—Ä–∏–∑</h4>
                            <span class="prize-type-badge prize-type-main">–ì–æ–ª–æ–≤–Ω–∏–π</span>
                        </div>
                        <div class="prize-controls-grid">
                            <div class="prize-control-group">
                                <label>–ù–∞–∑–≤–∞ –ø—Ä–∏–∑—É:</label>
                                <input type="text" class="prize-input" id="main-prize-name" value="iPhone 15 Pro Max" oninput="updateGiveawayPreview()">
                            </div>
                            <div class="prize-control-group">
                                <label>–£–º–æ–≤–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è:</label>
                                <input type="text" class="prize-input" id="main-prize-condition" value="–ó–∞ –ø–æ–∫—É–ø–∫—É" oninput="updateGiveawayPreview()">
                            </div>
                            <div class="prize-control-group prize-description">
                                <label>–û–ø–∏—Å –ø—Ä–∏–∑—É:</label>
                                <textarea class="prize-input" id="main-prize-description" oninput="updateGiveawayPreview()">–ù–æ–≤–µ–Ω—å–∫–∏–π iPhone 15 Pro Max –∑ –Ω–∞–π—Å—É—á–∞—Å–Ω—ñ—à–∏–º–∏ —Ñ—É–Ω–∫—Ü—ñ—è–º–∏</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="prize-item-control">
                        <div class="prize-item-header">
                            <h4><i class="fas fa-gift"></i> –î–æ–¥–∞—Ç–∫–æ–≤–∏–π –ø—Ä–∏–∑</h4>
                            <span class="prize-type-badge">–î–æ–¥–∞—Ç–∫–æ–≤–∏–π</span>
                        </div>
                        <div class="prize-controls-grid">
                            <div class="prize-control-group">
                                <label>–ù–∞–∑–≤–∞ –ø—Ä–∏–∑—É:</label>
                                <input type="text" class="prize-input" id="secondary-prize-name" value="AirPods Pro" oninput="updateGiveawayPreview()">
                            </div>
                            <div class="prize-control-group">
                                <label>–£–º–æ–≤–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è:</label>
                                <input type="text" class="prize-input" id="secondary-prize-condition" value="–ó–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é" oninput="updateGiveawayPreview()">
                            </div>
                            <div class="prize-control-group prize-description">
                                <label>–û–ø–∏—Å –ø—Ä–∏–∑—É:</label>
                                <textarea class="prize-input" id="secondary-prize-description" oninput="updateGiveawayPreview()">–ù–∞–≤—É—à–Ω–∏–∫–∏ AirPods Pro –∑ —Ñ—É–Ω–∫—Ü—ñ—î—é –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —à—É–º–æ–∑–∞–≥–ª—É—à–µ–Ω–Ω—è</textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –î–æ–¥–∞—Ç–∫–æ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è -->
                <div class="giveaway-controls">
                    <div class="giveaway-control-group">
                        <label>
                            <i class="fas fa-users"></i>
                            –ö—ñ–ª—å–∫—ñ—Å—Ç—å —É—á–∞—Å–Ω–∏–∫—ñ–≤:
                        </label>
                        <input type="number" id="participants-count" class="giveaway-date-input" value="2458" min="0" oninput="updateGiveawayPreview()">
                    </div>
                    
                    <div class="giveaway-control-group">
                        <label>
                            <i class="fas fa-store"></i>
                            –ù–∞–∑–≤–∞ –º–∞–≥–∞–∑–∏–Ω—É:
                        </label>
                        <input type="text" id="store-name" class="giveaway-date-input" value="iMarket Sell" oninput="updateGiveawayPreview()">
                    </div>
                </div>

                <!-- Current Banner Info -->
                <div class="current-banner-info">
                    <h4>–ü–æ—Ç–æ—á–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è:</h4>
                    <p id="current-banner-info">–§–æ–Ω: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –≥—Ä–∞–¥—ñ—î–Ω—Ç | –î–∞—Ç–∞: 27.11.2024 | –£—á–∞—Å–Ω–∏–∫—ñ–≤: 2,458</p>
                </div>

                <!-- Save Button -->
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="saveGiveawaySettings()">
                        <i class="fas fa-save"></i>
                        –ó–±–µ—Ä–µ–≥—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
                    </button>
                    <button class="btn btn-secondary" onclick="resetGiveawaySettings()">
                        <i class="fas fa-undo"></i>
                        –°–∫–∏–Ω—É—Ç–∏
                    </button>
                    <button class="btn btn-success" onclick="testGiveawaySync()">
                        <i class="fas fa-sync"></i>
                        –¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
                    </button>
                </div>
            </div>
        </div>

        <!-- Add/Edit Product Modal -->
        <div class="modal" id="product-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modal-title">–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä</h2>
                    <button class="close-btn" onclick="closeProductModal()">&times;</button>
                </div>
                
                <form id="product-form" onsubmit="saveProduct(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-name">–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É *</label>
                            <input type="text" id="product-name" required>
                        </div>
                        <div class="form-group">
                            <label for="product-model">–ú–æ–¥–µ–ª—å *</label>
                            <input type="text" id="product-model" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-category">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è *</label>
                            <select id="product-category" required>
                                <option value="">–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</option>
                                <option value="iphone">iPhone</option>
                                <option value="ipad">iPad</option>
                                <option value="macbook">MacBook</option>
                                <option value="apple-watch">Apple Watch</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="product-price">–¶—ñ–Ω–∞ (‚Ç¥) *</label>
                            <input type="number" id="product-price" min="0" step="1" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="product-specs">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</label>
                        <input type="text" id="product-specs" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 6.1'' Super Retina XDR">
                    </div>

                    <div class="form-group">
                        <label for="product-description">–û–ø–∏—Å</label>
                        <textarea id="product-description" rows="3" placeholder="–î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å —Ç–æ–≤–∞—Ä—É..."></textarea>
                    </div>

                    <!-- Image Upload -->
                    <div class="form-group">
                        <label>–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É</label>
                        <div class="image-upload-container">
                            <div class="image-previews" id="image-previews">
                                <div class="image-preview-placeholder">
                                    <i class="fas fa-images"></i>
                                    <span>–î–æ–¥–∞–π—Ç–µ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä—É</span>
                                </div>
                            </div>
                            <div class="upload-controls">
                                <input type="file" id="product-images" accept="image/*" multiple style="display: none;" onchange="handleImageUpload(event)">
                                <button type="button" class="btn btn-secondary" onclick="document.getElementById('product-images').click()">
                                    <i class="fas fa-plus"></i>
                                    –î–æ–¥–∞—Ç–∏ —Ñ–æ—Ç–æ
                                </button>
                                <button type="button" class="btn btn-outline" onclick="clearAllImages()">
                                    <i class="fas fa-trash"></i>
                                    –í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ
                                </button>
                            </div>
                            <div class="upload-info">
                                <small>–ú–æ–∂–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–æ 5 —Ñ–æ—Ç–æ. –ü–µ—Ä—à–µ —Ñ–æ—Ç–æ –±—É–¥–µ –æ—Å–Ω–æ–≤–Ω–∏–º.</small>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Characteristics -->
                    <div class="form-group">
                        <label>–î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</label>
                        <div id="characteristics-container">
                            <!-- Characteristics will be added here -->
                        </div>
                        <button type="button" class="btn btn-outline" onclick="addCharacteristic()">
                            <i class="fas fa-plus"></i>
                            –î–æ–¥–∞—Ç–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É
                        </button>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeProductModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                        <button type="submit" class="btn btn-primary" id="save-product-btn">–ó–±–µ—Ä–µ–≥—Ç–∏ —Ç–æ–≤–∞—Ä</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal" id="delete-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>–í–∏–¥–∞–ª–∏—Ç–∏ —Ç–æ–≤–∞—Ä</h2>
                </div>
                <p>–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ç–æ–≤–∞—Ä? –¶—é –¥—ñ—é –Ω–µ–º–æ–∂–ª–∏–≤–æ —Å–∫–∞—Å—É–≤–∞—Ç–∏.</p>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeDeleteModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="button" class="btn btn-danger" onclick="confirmDelete()">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                </div>
            </div>
        </div>

        <!-- User History Modal -->
        <div class="modal" id="user-history-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>–Ü—Å—Ç–æ—Ä—ñ—è –∑–∞–º–æ–≤–ª–µ–Ω—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</h2>
                    <button class="close-btn" onclick="closeUserHistoryModal()">&times;</button>
                </div>
                <div class="user-history-content" id="user-history-content">
                    <!-- –Ü—Å—Ç–æ—Ä—ñ—è –∑–∞–º–æ–≤–ª–µ–Ω—å –±—É–¥–µ –¥–æ–¥–∞–Ω–∞ —Ç—É—Ç -->
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï SUPABASE -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // ==== –í–ê–®–ò –ö–õ–Æ–ß–ò SUPABASE ====
        const supabaseUrl = 'https://mkyeotrxjswptzytnpgi.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1reWVvdHJ4anN3cHR6eXRucGdpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4NDY0NzEsImV4cCI6MjA3NzQyMjQ3MX0.WGj4n2CdAVmLaX77fP-yoLgesS3P1zC9wj3YqM73QXY';
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ
        let products = [];
        let currentEditingId = null;
        let productToDelete = null;
        let productImages = [];
        let currentEditingUser = null;
        let currentChatUser = null;
        let supportChatInterval = null;
        let currentBannerImage = null;
        let passwordVisibility = {};

        // Broadcast Channel –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
        const broadcastChannel = new BroadcastChannel('products_updates');
        const supportChannel = new BroadcastChannel('support_messages');
        const giveawayChannel = new BroadcastChannel('giveaway_updates');

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log('–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∞–¥–º—ñ–Ω–∫–∏ –∑ Supabase...');
            loadProducts();
            loadUsers();
            loadSupportChats();
            loadGiveawaySettings();
            setupBroadcastListener();
            autoSyncOnLoad();
            startSupportPolling();
            initializeChatFields();
        });

        // ========== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø SUPABASE ==========

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ Supabase
        async function loadProducts() {
            try {
                showNotification('üîÑ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤...', 'info');
                
                const { data, error } = await supabase
                    .from('products')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤:', error);
                    showNotification('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤', 'error');
                    return;
                }

                products = data || [];
                displayProducts(products);
                updateProductsCount();
                
                showNotification(`‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ ${products.length} —Ç–æ–≤–∞—Ä—ñ–≤`, 'success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showNotification('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤', 'error');
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ Supabase
        async function saveProduct(event) {
            event.preventDefault();
            
            const saveBtn = document.getElementById('save-product-btn');
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è...';

            try {
                const formData = {
                    name: document.getElementById('product-name').value,
                    model: document.getElementById('product-model').value,
                    category: document.getElementById('product-category').value,
                    price: parseInt(document.getElementById('product-price').value),
                    specs: document.getElementById('product-specs').value,
                    description: document.getElementById('product-description').value,
                    status: 'in-stock',
                    images: productImages.map(img => img.data),
                    main_image: productImages.find(img => img.isMain)?.data || productImages[0]?.data || '',
                    characteristics: getCharacteristicsData(),
                    created_at: new Date().toISOString(),
                    last_updated: Date.now()
                };

                let result;
                if (currentEditingId) {
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                    const { data, error } = await supabase
                        .from('products')
                        .update(formData)
                        .eq('id', currentEditingId)
                        .select();

                    if (error) throw error;
                    result = data;
                } else {
                    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
                    const { data, error } = await supabase
                        .from('products')
                        .insert([formData])
                        .select();

                    if (error) throw error;
                    result = data;
                }

                showNotification(currentEditingId ? '‚úÖ –¢–æ–≤–∞—Ä –æ–Ω–æ–≤–ª–µ–Ω–æ!' : '‚úÖ –¢–æ–≤–∞—Ä –¥–æ–¥–∞–Ω–æ!', 'success');
                closeProductModal();
                loadProducts(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                showNotification('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É', 'error');
            } finally {
                saveBtn.disabled = false;
                saveBtn.innerHTML = '–ó–±–µ—Ä–µ–≥—Ç–∏ —Ç–æ–≤–∞—Ä';
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –∏–∑ Supabase
        async function confirmDelete() {
            if (!productToDelete) return;

            try {
                const { error } = await supabase
                    .from('products')
                    .delete()
                    .eq('id', productToDelete);

                if (error) throw error;

                showNotification('‚úÖ –¢–æ–≤–∞—Ä –≤–∏–¥–∞–ª–µ–Ω–æ!', 'success');
                closeDeleteModal();
                loadProducts(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);
                showNotification('‚ùå –ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É', 'error');
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
        function getCharacteristicsData() {
            const characteristics = {};
            const characteristicRows = document.querySelectorAll('.characteristic-row');
            
            characteristicRows.forEach(row => {
                const keyInput = row.querySelector('input[name^="characteristic-key"]');
                const valueInput = row.querySelector('input[name^="characteristic-value"]');
                
                if (keyInput.value && valueInput.value) {
                    characteristics[keyInput.value] = valueInput.value;
                }
            });
            
            return Object.keys(characteristics).length > 0 ? characteristics : null;
        }

        // ========== –û–°–¢–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ==========

        function displayProducts(products) {
            const productsGrid = document.getElementById('products-grid');
            
            if (products.length === 0) {
                productsGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1; text-align: center; padding: 60px 20px;">
                        <div style="font-size: 64px; margin-bottom: 20px;">üì¶</div>
                        <h3 style="margin-bottom: 10px; color: #333;">–ù–µ–º–∞—î —Ç–æ–≤–∞—Ä—ñ–≤</h3>
                        <p style="margin-bottom: 25px; color: #666;">–î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à–∏–π —Ç–æ–≤–∞—Ä –¥–æ –≤–∞—à–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω—É</p>
                        <button class="btn btn-primary" onclick="openAddProductModal()">
                            <i class="fas fa-plus"></i>
                            –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä
                        </button>
                    </div>
                `;
                return;
            }

            productsGrid.innerHTML = products.map(product => `
                <div class="product-card" data-category="${product.category}" data-status="${product.status || 'in-stock'}">
                    <div class="product-image">
                        ${product.main_image || product.images?.[0] ? 
                            `<img src="${product.main_image || product.images[0]}" alt="${product.name}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"> 
                             <div class="placeholder" style="display: none;"><i class="fas fa-image"></i></div>` :
                            `<div class="placeholder"><i class="fas fa-image"></i></div>`
                        }
                    </div>
                    <div class="product-info">
                        <div class="product-model">${product.model}</div>
                        <h3>${product.name}</h3>
                        <div class="product-specs">${product.specs || ''}</div>
                        <div class="product-price">${formatPrice(product.price)} ‚Ç¥</div>
                        <div class="product-status" style="font-size: 12px; color: ${product.status === 'out-of-stock' ? '#e53935' : '#4CAF50'}; margin-bottom: 10px;">
                            ${product.status === 'out-of-stock' ? '‚ùå –ù–µ–º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ' : '‚úÖ –í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ'}
                        </div>
                        <div class="product-actions">
                            <button class="btn btn-outline" onclick="editProduct(${product.id})">
                                <i class="fas fa-edit"></i>
                                –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
                            </button>
                            <button class="btn btn-danger" onclick="openDeleteModal(${product.id})">
                                <i class="fas fa-trash"></i>
                                –í–∏–¥–∞–ª–∏—Ç–∏
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function formatPrice(price) {
            return parseInt(price).toLocaleString('uk-UA');
        }

        function updateProductsCount() {
            const countElement = document.getElementById('products-count');
            countElement.textContent = `${products.length} —Ç–æ–≤–∞—Ä${products.length % 10 === 1 ? '' : '–∏'}`;
        }

        function filterProducts() {
            const searchTerm = document.getElementById('search-products').value.toLowerCase();
            const categoryFilter = document.getElementById('category-filter').value;
            const statusFilter = document.getElementById('status-filter').value;
            
            const productCards = document.querySelectorAll('.product-card');
            
            productCards.forEach(card => {
                const productName = card.querySelector('h3').textContent.toLowerCase();
                const productCategory = card.getAttribute('data-category');
                const productStatus = card.getAttribute('data-status');
                
                const matchesSearch = productName.includes(searchTerm);
                const matchesCategory = !categoryFilter || productCategory === categoryFilter;
                const matchesStatus = !statusFilter || productStatus === statusFilter;
                
                card.style.display = (matchesSearch && matchesCategory && matchesStatus) ? 'block' : 'none';
            });
        }

        function openAddProductModal() {
            currentEditingId = null;
            productImages = [];
            document.getElementById('modal-title').textContent = '–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä';
            document.getElementById('product-form').reset();
            updateImagePreviews();
            document.getElementById('characteristics-container').innerHTML = '';
            document.getElementById('product-modal').classList.add('active');
        }

        function closeProductModal() {
            document.getElementById('product-modal').classList.remove('active');
        }

        function handleImageUpload(event) {
            const files = event.target.files;
            const previewsContainer = document.getElementById('image-previews');
            
            const placeholder = previewsContainer.querySelector('.image-preview-placeholder');
            if (placeholder) {
                placeholder.remove();
            }
            
            for (let i = 0; i < files.length; i++) {
                if (productImages.length >= 5) {
                    alert('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –º–æ–∂–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ 5 —Ñ–æ—Ç–æ');
                    break;
                }
                
                const file = files[i];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const imageData = {
                        id: Date.now() + i,
                        data: e.target.result,
                        isMain: productImages.length === 0
                    };
                    
                    productImages.push(imageData);
                    updateImagePreviews();
                };
                
                reader.readAsDataURL(file);
            }
            
            event.target.value = '';
        }

        function updateImagePreviews() {
            const previewsContainer = document.getElementById('image-previews');
            previewsContainer.innerHTML = '';
            
            if (productImages.length === 0) {
                previewsContainer.innerHTML = `
                    <div class="image-preview-placeholder">
                        <i class="fas fa-images"></i>
                        <span>–î–æ–¥–∞–π—Ç–µ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä—É</span>
                    </div>
                `;
                return;
            }
            
            productImages.forEach((image, index) => {
                const previewItem = document.createElement('div');
                previewItem.className = `image-preview-item ${image.isMain ? 'main-image' : ''}`;
                previewItem.innerHTML = `
                    <img src="${image.data}" alt="Preview ${index + 1}">
                    ${image.isMain ? '<div class="main-badge">–ì–æ–ª–æ–≤–Ω–µ</div>' : ''}
                    <div class="image-actions">
                        <button class="image-action-btn" onclick="setAsMainImage(${image.id})" title="–ó—Ä–æ–±–∏—Ç–∏ –≥–æ–ª–æ–≤–Ω–∏–º">
                            <i class="fas fa-star"></i>
                        </button>
                        <button class="image-action-btn" onclick="removeImage(${image.id})" title="–í–∏–¥–∞–ª–∏—Ç–∏">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                previewsContainer.appendChild(previewItem);
            });
        }

        function setAsMainImage(imageId) {
            productImages.forEach(image => {
                image.isMain = image.id === imageId;
            });
            updateImagePreviews();
        }

        function removeImage(imageId) {
            const imageIndex = productImages.findIndex(img => img.id === imageId);
            const isMain = productImages[imageIndex].isMain;
            
            productImages.splice(imageIndex, 1);
            
            if (isMain && productImages.length > 0) {
                productImages[0].isMain = true;
            }
            
            updateImagePreviews();
        }

        function clearAllImages() {
            productImages = [];
            updateImagePreviews();
        }

        function addCharacteristic() {
            const container = document.getElementById('characteristics-container');
            const index = container.children.length;
            
            const characteristicRow = document.createElement('div');
            characteristicRow.className = 'characteristic-row';
            characteristicRow.innerHTML = `
                <input type="text" placeholder="–ù–∞–∑–≤–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–Ω–∞–ø—Ä. –ü—Ä–æ—Ü–µ—Å–æ—Ä)" name="characteristic-key-${index}">
                <input type="text" placeholder="–ó–Ω–∞—á–µ–Ω–Ω—è (–Ω–∞–ø—Ä. A15 Bionic)" name="characteristic-value-${index}">
                <button type="button" class="remove-characteristic" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(characteristicRow);
        }

        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            currentEditingId = productId;
            document.getElementById('modal-title').textContent = '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ç–æ–≤–∞—Ä';
            
            document.getElementById('product-name').value = product.name;
            document.getElementById('product-model').value = product.model;
            document.getElementById('product-category').value = product.category;
            document.getElementById('product-price').value = product.price;
            document.getElementById('product-specs').value = product.specs || '';
            document.getElementById('product-description').value = product.description || '';
            
            productImages = [];
            if (product.images && product.images.length > 0) {
                product.images.forEach((imageData, index) => {
                    productImages.push({
                        id: Date.now() + index,
                        data: imageData,
                        isMain: imageData === product.main_image || index === 0
                    });
                });
            }
            updateImagePreviews();
            
            const container = document.getElementById('characteristics-container');
            container.innerHTML = '';
            
            if (product.characteristics) {
                Object.entries(product.characteristics).forEach(([key, value], index) => {
                    const characteristicRow = document.createElement('div');
                    characteristicRow.className = 'characteristic-row';
                    characteristicRow.innerHTML = `
                        <input type="text" placeholder="–ù–∞–∑–≤–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏" name="characteristic-key-${index}" value="${key}">
                        <input type="text" placeholder="–ó–Ω–∞—á–µ–Ω–Ω—è" name="characteristic-value-${index}" value="${value}">
                        <button type="button" class="remove-characteristic" onclick="this.parentElement.remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    container.appendChild(characteristicRow);
                });
            }
            
            document.getElementById('product-modal').classList.add('active');
        }

        function openDeleteModal(productId) {
            productToDelete = productId;
            document.getElementById('delete-modal').classList.add('active');
        }

        function closeDeleteModal() {
            productToDelete = null;
            document.getElementById('delete-modal').classList.remove('active');
        }

        function exportProducts() {
            if (products.length === 0) {
                showNotification('‚ùå –ù–µ–º–∞—î —Ç–æ–≤–∞—Ä—ñ–≤ –¥–ª—è –µ–∫—Å–ø–æ—Ä—Ç—É!', 'error');
                return;
            }
            
            const dataStr = JSON.stringify(products, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `istore-products-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('üì¶ –¢–æ–≤–∞—Ä–∏ –µ–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ!', 'success');
        }

        function syncWithMainSite() {
            localStorage.setItem('storeProducts', JSON.stringify(products));
            localStorage.setItem('productsLastUpdate', Date.now().toString());
            
            broadcastChannel.postMessage({
                type: 'products_updated',
                timestamp: Date.now(),
                count: products.length
            });
            
            showNotification('‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –≤–∏–∫–æ–Ω–∞–Ω–∞!', 'success');
        }

        function autoSyncOnLoad() {
            const adminProducts = JSON.parse(localStorage.getItem('adminProducts')) || [];
            const storeProducts = JSON.parse(localStorage.getItem('storeProducts')) || [];
            
            if (adminProducts.length > 0 && storeProducts.length === 0) {
                syncWithMainSite();
            }
        }

        function setupBroadcastListener() {
            broadcastChannel.onmessage = (event) => {
                if (event.data.type === 'products_updated') {
                    console.log('–û—Ç—Ä–∏–º–∞–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤');
                    loadProducts();
                    updateProductsCount();
                }
            };
            
            supportChannel.onmessage = (event) => {
                if (event.data.type === 'messages_updated') {
                    console.log('–û—Ç—Ä–∏–º–∞–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—ñ–¥—Ç—Ä–∏–º–∫–∏');
                    loadSupportChats();
                    if (currentChatUser) {
                        loadChatMessages(currentChatUser);
                    }
                }
            };

            giveawayChannel.onmessage = (event) => {
                if (event.data.type === 'giveaway_updated') {
                    console.log('–û—Ç—Ä–∏–º–∞–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–æ–∑—ñ–≥—Ä–∞—à—É');
                    loadGiveawaySettings();
                }
            };
        }

        function switchAdminTab(tab) {
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.products-section, .users-section, .support-chat-section, .support-chat-section').forEach(s => s.classList.remove('active'));
            
            const tabIndex = {'products': 1, 'users': 2, 'support-chat': 3, 'giveaway': 4}[tab];
            const tabElement = document.querySelector(`.admin-tab:nth-child(${tabIndex})`);
            const sectionElement = document.getElementById(`${tab}-section`);
            
            if (tabElement) tabElement.classList.add('active');
            if (sectionElement) sectionElement.classList.add('active');

            if (tab === 'giveaway') {
                updateGiveawayPreview();
            }
        }

        // ========== –§–£–ù–ö–¶–Ü–á –î–õ–Ø –†–û–ó–Ü–ì–†–ê–®–£ ==========

        function loadGiveawaySettings() {
            const giveawaySettings = JSON.parse(localStorage.getItem('giveawaySettings')) || {};
            
            if (giveawaySettings.date) {
                document.getElementById('giveaway-date').value = giveawaySettings.date;
            } else {
                const defaultDate = new Date();
                defaultDate.setDate(defaultDate.getDate() + 30);
                document.getElementById('giveaway-date').value = defaultDate.toISOString().split('T')[0];
            }
            
            if (giveawaySettings.storeName) {
                document.getElementById('store-name').value = giveawaySettings.storeName;
            }
            if (giveawaySettings.participants) {
                document.getElementById('participants-count').value = giveawaySettings.participants;
            }
            if (giveawaySettings.mainPrize) {
                document.getElementById('main-prize-name').value = giveawaySettings.mainPrize.name;
                document.getElementById('main-prize-condition').value = giveawaySettings.mainPrize.condition;
                document.getElementById('main-prize-description').value = giveawaySettings.mainPrize.description;
            }
            if (giveawaySettings.secondaryPrize) {
                document.getElementById('secondary-prize-name').value = giveawaySettings.secondaryPrize.name;
                document.getElementById('secondary-prize-condition').value = giveawaySettings.secondaryPrize.condition;
                document.getElementById('secondary-prize-description').value = giveawaySettings.secondaryPrize.description;
            }
            
            if (giveawaySettings.background) {
                currentBannerImage = giveawaySettings.background;
                document.getElementById('giveaway-preview').style.backgroundImage = `url(${giveawaySettings.background})`;
                document.getElementById('giveaway-preview').style.backgroundSize = 'cover';
                document.getElementById('giveaway-preview').style.backgroundPosition = 'center';
            }
            
            updateGiveawayPreview();
            updateCurrentBannerInfo();
        }

        function updateGiveawayPreview() {
            const dateInput = document.getElementById('giveaway-date');
            const previewDate = document.getElementById('preview-date');
            
            if (dateInput.value) {
                const date = new Date(dateInput.value);
                const formattedDate = date.toLocaleDateString('uk-UA');
                previewDate.textContent = formattedDate;
            }
            
            const storeName = document.getElementById('store-name').value;
            document.getElementById('preview-store-logo').innerHTML = `i<span>${storeName}</span>`;
            
            const mainPrizeName = document.getElementById('main-prize-name').value;
            const mainPrizeCondition = document.getElementById('main-prize-condition').value;
            const secondaryPrizeName = document.getElementById('secondary-prize-name').value;
            const secondaryPrizeCondition = document.getElementById('secondary-prize-condition').value;
            
            document.getElementById('preview-main-prize-name').textContent = mainPrizeName;
            document.getElementById('preview-main-prize-condition').textContent = mainPrizeCondition;
            document.getElementById('preview-secondary-prize-name').textContent = secondaryPrizeName;
            document.getElementById('preview-secondary-prize-condition').textContent = secondaryPrizeCondition;
            
            const participants = document.getElementById('participants-count').value;
            document.getElementById('preview-participants').textContent = parseInt(participants).toLocaleString('uk-UA');
            
            updateCurrentBannerInfo();
        }

        function handleBannerUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                currentBannerImage = e.target.result;
                document.getElementById('giveaway-preview').style.backgroundImage = `url(${e.target.result})`;
                document.getElementById('giveaway-preview').style.backgroundSize = 'cover';
                document.getElementById('giveaway-preview').style.backgroundPosition = 'center';
                updateCurrentBannerInfo();
            };
            reader.readAsDataURL(file);
        }

        function updateCurrentBannerInfo() {
            const dateInput = document.getElementById('giveaway-date');
            const participants = document.getElementById('participants-count').value;
            
            const date = dateInput.value ? new Date(dateInput.value).toLocaleDateString('uk-UA') : '–ù–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
            const bannerInfo = currentBannerImage ? '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–µ —Ñ–æ—Ç–æ' : '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –≥—Ä–∞–¥—ñ—î–Ω—Ç';
            
            document.getElementById('current-banner-info').textContent = `–§–æ–Ω: ${bannerInfo} | –î–∞—Ç–∞: ${date} | –£—á–∞—Å–Ω–∏–∫—ñ–≤: ${parseInt(participants).toLocaleString('uk-UA')}`;
        }

        function saveGiveawaySettings() {
            const dateInput = document.getElementById('giveaway-date').value;
            
            if (!dateInput) {
                showNotification('‚ùå –ë—É–¥—å –ª–∞—Å–∫–∞, –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –¥–∞—Ç—É —Ä–æ–∑—ñ–≥—Ä–∞—à—É', 'error');
                return;
            }
            
            const giveawaySettings = {
                date: dateInput,
                storeName: document.getElementById('store-name').value,
                participants: document.getElementById('participants-count').value,
                mainPrize: {
                    name: document.getElementById('main-prize-name').value,
                    condition: document.getElementById('main-prize-condition').value,
                    description: document.getElementById('main-prize-description').value
                },
                secondaryPrize: {
                    name: document.getElementById('secondary-prize-name').value,
                    condition: document.getElementById('secondary-prize-condition').value,
                    description: document.getElementById('secondary-prize-description').value
                },
                background: currentBannerImage,
                lastUpdated: Date.now()
            };
            
            localStorage.setItem('giveawaySettings', JSON.stringify(giveawaySettings));
            
            broadcastGiveawayUpdate();
            
            showNotification('‚úÖ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ä–æ–∑—ñ–≥—Ä–∞—à—É –∑–±–µ—Ä–µ–∂–µ–Ω–æ!', 'success');
        }

        function broadcastGiveawayUpdate() {
            localStorage.setItem('giveawayLastUpdate', Date.now().toString());
            
            if (typeof BroadcastChannel !== 'undefined') {
                giveawayChannel.postMessage({
                    type: 'giveaway_updated',
                    timestamp: Date.now(),
                    data: JSON.parse(localStorage.getItem('giveawaySettings'))
                });
            }
            
            localStorage.setItem('mainPageGiveawayData', localStorage.getItem('giveawaySettings'));
        }

        function resetGiveawaySettings() {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ —Å–∫–∏–Ω—É—Ç–∏ –≤—Å—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ä–æ–∑—ñ–≥—Ä–∞—à—É?')) {
                document.getElementById('giveaway-date').value = '';
                document.getElementById('store-name').value = 'iMarket Sell';
                document.getElementById('participants-count').value = '2458';
                document.getElementById('main-prize-name').value = 'iPhone 15 Pro Max';
                document.getElementById('main-prize-condition').value = '–ó–∞ –ø–æ–∫—É–ø–∫—É';
                document.getElementById('main-prize-description').value = '–ù–æ–≤–µ–Ω—å–∫–∏–π iPhone 15 Pro Max –∑ –Ω–∞–π—Å—É—á–∞—Å–Ω—ñ—à–∏–º–∏ —Ñ—É–Ω–∫—Ü—ñ—è–º–∏';
                document.getElementById('secondary-prize-name').value = 'AirPods Pro';
                document.getElementById('secondary-prize-condition').value = '–ó–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é';
                document.getElementById('secondary-prize-description').value = '–ù–∞–≤—É—à–Ω–∏–∫–∏ AirPods Pro –∑ —Ñ—É–Ω–∫—Ü—ñ—î—é –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —à—É–º–æ–∑–∞–≥–ª—É—à–µ–Ω–Ω—è';
                
                currentBannerImage = null;
                const preview = document.getElementById('giveaway-preview');
                preview.style.backgroundImage = '';
                preview.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 50%, #8e44ad 100%)';
                
                updateGiveawayPreview();
                
                showNotification('‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–∫–∏–Ω—É—Ç–æ –¥–æ –∑–Ω–∞—á–µ–Ω—å –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º', 'info');
            }
        }

        function testGiveawaySync() {
            const giveawayData = localStorage.getItem('giveawaySettings');
            if (giveawayData) {
                const settings = JSON.parse(giveawayData);
                console.log('–¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó:', settings);
                showNotification('üîç –î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω—ñ! –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.', 'success');
            } else {
                showNotification('‚ùå –ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó', 'error');
            }
        }

        // ========== –°–ò–°–¢–ï–ú–ê –ß–ê–¢–£ –ü–Ü–î–¢–†–ò–ú–ö–ò ==========

        function initializeChatFields() {
            const adminMessageInput = document.getElementById('admin-message-input');
            if (adminMessageInput) {
                adminMessageInput.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = (this.scrollHeight) + 'px';
                });

                adminMessageInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendAdminMessage();
                    }
                });
            }
        }

        function loadSupportChats() {
            const chatUsersList = document.getElementById('chat-users-list');
            const allMessages = getAllSupportMessages();
            
            const uniqueUsers = {};
            allMessages.forEach(msg => {
                if (!uniqueUsers[msg.userId]) {
                    uniqueUsers[msg.userId] = {
                        userId: msg.userId,
                        lastMessage: msg.text,
                        lastMessageTime: msg.timestamp,
                        unread: countUnreadMessages(msg.userId)
                    };
                } else {
                    if (new Date(msg.timestamp) > new Date(uniqueUsers[msg.userId].lastMessageTime)) {
                        uniqueUsers[msg.userId].lastMessage = msg.text;
                        uniqueUsers[msg.userId].lastMessageTime = msg.timestamp;
                    }
                }
            });
            
            const usersArray = Object.values(uniqueUsers);
            
            if (usersArray.length === 0) {
                chatUsersList.innerHTML = `
                    <div class="empty-users">
                        <i class="fas fa-comments"></i>
                        <h3>–ß–∞—Ç—ñ–≤ –Ω–µ–º–∞—î</h3>
                        <p>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —â–µ –Ω–µ –∑–≤–µ—Ä—Ç–∞–ª–∏—Å—è –¥–æ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏</p>
                    </div>
                `;
                return;
            }
            
            usersArray.sort((a, b) => new Date(b.lastMessageTime) - new Date(a.lastMessageTime));
            
            chatUsersList.innerHTML = usersArray.map(user => `
                <div class="chat-user-item ${currentChatUser === user.userId ? 'active' : ''}" onclick="selectChatUser('${user.userId}')">
                    <div class="chat-user-info">
                        <div class="chat-user-name">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á ${user.userId.substring(5)}</div>
                        <div class="chat-user-last-message">${user.lastMessage.length > 50 ? user.lastMessage.substring(0, 50) + '...' : user.lastMessage}</div>
                    </div>
                    <div class="chat-user-meta">
                        <div class="chat-user-time">${formatMessageTime(user.lastMessageTime)}</div>
                        ${user.unread > 0 ? `<div class="unread-badge">${user.unread}</div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function getAllSupportMessages() {
            return JSON.parse(localStorage.getItem('supportMessages')) || [];
        }

        function getUserSupportMessages(userId) {
            const allMessages = getAllSupportMessages();
            return allMessages.filter(msg => msg.userId === userId);
        }

        function countUnreadMessages(userId) {
            const userMessages = getUserSupportMessages(userId);
            return userMessages.filter(msg => msg.type === 'user' && !msg.read).length;
        }

        function selectChatUser(userId) {
            currentChatUser = userId;
            loadSupportChats();
            loadChatMessages(userId);
            markMessagesAsRead(userId);
        }

        function loadChatMessages(userId) {
            const adminChatMessages = document.getElementById('admin-chat-messages');
            const userMessages = getUserSupportMessages(userId);
            
            adminChatMessages.innerHTML = '';
            
            userMessages.forEach(msg => {
                addAdminMessageToChat(msg.text, msg.type, msg.timestamp, false);
            });
            
            adminChatMessages.scrollTop = adminChatMessages.scrollHeight;
            
            document.getElementById('no-chat-selected').style.display = 'none';
            document.getElementById('selected-chat-info').style.display = 'block';
            document.getElementById('admin-chat-input-container').style.display = 'block';
            
            document.getElementById('selected-user-name').textContent = `–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á ${userId.substring(5)}`;
        }

        function addAdminMessageToChat(text, sender, timestamp, animate = true) {
            const adminChatMessages = document.getElementById('admin-chat-messages');
            const messageDiv = document.createElement('div');
            
            const messageTime = new Date(timestamp);
            const timeString = messageTime.getHours().toString().padStart(2, '0') + ':' + 
                             messageTime.getMinutes().toString().padStart(2, '0');
            
            messageDiv.className = `admin-message ${sender}`;
            if (animate) {
                messageDiv.style.animation = 'fadeIn 0.3s ease-out';
            }
            
            messageDiv.innerHTML = `
                <div class="admin-message-text">${text}</div>
                <div class="admin-message-time">${timeString}</div>
            `;
            
            adminChatMessages.appendChild(messageDiv);
            adminChatMessages.scrollTop = adminChatMessages.scrollHeight;
        }

        function sendAdminMessage() {
            if (!currentChatUser) {
                showNotification('–û–±–µ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ', 'error');
                return;
            }
            
            const messageInput = document.getElementById('admin-message-input');
            const messageText = messageInput.value.trim();
            
            if (messageText === '') {
                showNotification('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è', 'error');
                return;
            }
            
            const message = {
                id: 'msg_' + Date.now(),
                userId: currentChatUser,
                text: messageText,
                type: 'agent',
                timestamp: new Date().toISOString(),
                read: true
            };
            
            saveSupportMessage(message);
            addAdminMessageToChat(messageText, 'agent', message.timestamp, true);
            
            messageInput.value = '';
            messageInput.style.height = 'auto';
            
            broadcastSupportUpdate();
            
            showNotification('–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ', 'success');
        }

        function saveSupportMessage(message) {
            const allMessages = getAllSupportMessages();
            allMessages.push(message);
            localStorage.setItem('supportMessages', JSON.stringify(allMessages));
        }

        function markMessagesAsRead(userId) {
            const allMessages = getAllSupportMessages();
            let updated = false;
            
            allMessages.forEach(msg => {
                if (msg.userId === userId && msg.type === 'user' && !msg.read) {
                    msg.read = true;
                    updated = true;
                }
            });
            
            if (updated) {
                localStorage.setItem('supportMessages', JSON.stringify(allMessages));
                loadSupportChats();
            }
        }

        function formatMessageTime(timestamp) {
            const messageTime = new Date(timestamp);
            const now = new Date();
            const diffMs = now - messageTime;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return '—â–æ–π–Ω–æ';
            if (diffMins < 60) return `${diffMins} —Ö–≤`;
            if (diffHours < 24) return `${diffHours} –≥–æ–¥`;
            if (diffDays < 7) return `${diffDays} –¥–Ω`;
            
            return messageTime.toLocaleDateString('uk-UA');
        }

        function broadcastSupportUpdate() {
            localStorage.setItem('supportLastUpdate', Date.now().toString());
            
            if (typeof BroadcastChannel !== 'undefined') {
                const channel = new BroadcastChannel('support_messages');
                channel.postMessage({
                    type: 'messages_updated',
                    timestamp: Date.now()
                });
            }
        }

        function startSupportPolling() {
            supportChatInterval = setInterval(() => {
                const lastUpdate = localStorage.getItem('supportLastUpdate');
                const currentUpdate = localStorage.getItem('currentAdminSupportUpdate');
                
                if (lastUpdate !== currentUpdate) {
                    loadSupportChats();
                    if (currentChatUser) {
                        loadChatMessages(currentChatUser);
                    }
                    localStorage.setItem('currentAdminSupportUpdate', lastUpdate);
                }
            }, 2000);
        }

        // ========== –£–ü–†–ê–í–õ–Ü–ù–ù–Ø –ö–û–†–ò–°–¢–£–í–ê–ß–ê–ú–ò ==========

        function loadUsers() {
            const usersTableBody = document.getElementById('users-table-body');
            const usersDatabase = JSON.parse(localStorage.getItem('storeUsers')) || [];
            
            if (usersDatabase.length === 0) {
                usersTableBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-users">
                            <i class="fas fa-users"></i>
                            <h3>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</h3>
                            <p>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑'—è–≤–ª—è—Ç—å—Å—è –ø—ñ—Å–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –Ω–∞ —Å–∞–π—Ç—ñ</p>
                        </td>
                    </tr>
                `;
                return;
            }

            usersTableBody.innerHTML = usersDatabase.map(user => {
                const isPasswordVisible = passwordVisibility[user.id] || false;
                const passwordDisplay = isPasswordVisible ? user.password : '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                
                return `
                <tr>
                    <td>${user.id}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.phone || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}</td>
                    <td>${passwordDisplay}</td>
                    <td>
                        <span class="user-status ${getUserStatusClass(user)}">
                            ${getUserStatusText(user)}
                        </span>
                    </td>
                    <td>${new Date(user.createdAt).toLocaleDateString('uk-UA')}</td>
                    <td class="user-actions">
                        ${user.isBlocked ? 
                            `<button class="user-btn unblock" onclick="toggleUserBlock(${user.id})">
                                <i class="fas fa-unlock"></i> –†–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏
                            </button>` :
                            `<button class="user-btn block" onclick="toggleUserBlock(${user.id})">
                                <i class="fas fa-ban"></i> –ó–∞–±–ª–æ–∫—É–≤–∞—Ç–∏
                            </button>`
                        }
                        ${!user.isAdmin ? 
                            `<button class="user-btn admin" onclick="toggleAdminStatus(${user.id})">
                                <i class="fas fa-crown"></i> –ó—Ä–æ–±–∏—Ç–∏ –∞–¥–º—ñ–Ω–æ–º
                            </button>` :
                            `<button class="user-btn admin" onclick="toggleAdminStatus(${user.id})" style="background: #6c757d;">
                                <i class="fas fa-user"></i> –ó–∞–±—Ä–∞—Ç–∏ –ø—Ä–∞–≤–∞
                            </button>`
                        }
                        <button class="user-btn password" onclick="togglePasswordVisibility(${user.id})">
                            <i class="fas ${isPasswordVisible ? 'fa-eye-slash' : 'fa-eye'}"></i> 
                            ${isPasswordVisible ? '–ü—Ä–∏—Ö–æ–≤–∞—Ç–∏' : '–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞—Ä–æ–ª—å'}
                        </button>
                        <button class="user-btn history" onclick="showUserHistory(${user.id})">
                            <i class="fas fa-history"></i> –Ü—Å—Ç–æ—Ä—ñ—è
                        </button>
                    </td>
                </tr>
            `}).join('');
        }

        function togglePasswordVisibility(userId) {
            passwordVisibility[userId] = !passwordVisibility[userId];
            loadUsers();
        }

        function getUserStatusClass(user) {
            if (user.isBlocked) return 'status-blocked';
            if (user.isAdmin) return 'status-admin';
            return 'status-active';
        }

        function getUserStatusText(user) {
            if (user.isBlocked) return '–ó–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏–π';
            if (user.isAdmin) return '–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä';
            return '–ê–∫—Ç–∏–≤–Ω–∏–π';
        }

        function toggleUserBlock(userId) {
            const usersDatabase = JSON.parse(localStorage.getItem('storeUsers')) || [];
            const userIndex = usersDatabase.findIndex(u => u.id === userId);
            
            if (userIndex !== -1) {
                usersDatabase[userIndex].isBlocked = !usersDatabase[userIndex].isBlocked;
                localStorage.setItem('storeUsers', JSON.stringify(usersDatabase));
                
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (currentUser && currentUser.id === userId) {
                    currentUser.isBlocked = usersDatabase[userIndex].isBlocked;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                }
                
                loadUsers();
                showNotification(usersDatabase[userIndex].isBlocked ? 
                    '‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ' : '‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ä–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω–æ', 'success');
            }
        }

        function toggleAdminStatus(userId) {
            const usersDatabase = JSON.parse(localStorage.getItem('storeUsers')) || [];
            const userIndex = usersDatabase.findIndex(u => u.id === userId);
            
            if (userIndex !== -1) {
                usersDatabase[userIndex].isAdmin = !usersDatabase[userIndex].isAdmin;
                localStorage.setItem('storeUsers', JSON.stringify(usersDatabase));
                
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (currentUser && currentUser.id === userId) {
                    currentUser.isAdmin = usersDatabase[userIndex].isAdmin;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                }
                
                loadUsers();
                showNotification(usersDatabase[userIndex].isAdmin ? 
                    '‚úÖ –ü—Ä–∞–≤–∞ –∞–¥–º—ñ–Ω–∞ –Ω–∞–¥–∞–Ω–æ' : '‚úÖ –ü—Ä–∞–≤–∞ –∞–¥–º—ñ–Ω–∞ –∑–∞–±—Ä–∞–Ω–æ', 'success');
            }
        }

        function showUserHistory(userId) {
            const usersDatabase = JSON.parse(localStorage.getItem('storeUsers')) || [];
            const user = usersDatabase.find(u => u.id === userId);
            
            if (!user) return;

            const historyContent = document.getElementById('user-history-content');
            const orders = user.orders || [];

            if (orders.length === 0) {
                historyContent.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #666;">
                        <i class="fas fa-shopping-bag" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <h3>–ó–∞–º–æ–≤–ª–µ–Ω—å –Ω–µ–º–∞—î</h3>
                        <p>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —â–µ –Ω–µ —Ä–æ–±–∏–≤ –∑–∞–º–æ–≤–ª–µ–Ω—å</p>
                    </div>
                `;
            } else {
                historyContent.innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <h3>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: ${user.name}</h3>
                        <p>Email: ${user.email}</p>
                        <p>–í—Å—å–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω—å: ${orders.length}</p>
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${orders.map(order => `
                            <div style="border: 1px solid #e1e1e1; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <strong>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #${order.id}</strong>
                                    <span style="color: #e53935; font-weight: bold;">${order.total ? order.total.toLocaleString('uk-UA') + ' ‚Ç¥' : '–¶—ñ–Ω–∞ –Ω–µ –≤–∫–∞–∑–∞–Ω–∞'}</span>
                                </div>
                                <div style="color: #666; font-size: 14px;">
                                    <div>–î–∞—Ç–∞: ${new Date(order.date).toLocaleDateString('uk-UA')}</div>
                                    <div>–°—Ç–∞—Ç—É—Å: ${order.status === 'completed' ? '‚úÖ –í–∏–∫–æ–Ω–∞–Ω–æ' : '‚è≥ –í –æ–±—Ä–æ–±—Ü—ñ'}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            document.getElementById('user-history-modal').classList.add('active');
        }

        function closeUserHistoryModal() {
            document.getElementById('user-history-modal').classList.remove('active');
        }

        function filterUsers() {
            const searchTerm = document.getElementById('search-users').value.toLowerCase();
            const statusFilter = document.getElementById('status-users-filter').value;
            
            const usersTableBody = document.getElementById('users-table-body');
            const usersDatabase = JSON.parse(localStorage.getItem('storeUsers')) || [];
            
            const filteredUsers = usersDatabase.filter(user => {
                const matchesSearch = user.name.toLowerCase().includes(searchTerm) || 
                                    user.email.toLowerCase().includes(searchTerm);
                
                let matchesStatus = true;
                if (statusFilter === 'active') {
                    matchesStatus = !user.isBlocked && !user.isAdmin;
                } else if (statusFilter === 'blocked') {
                    matchesStatus = user.isBlocked;
                } else if (statusFilter === 'admin') {
                    matchesStatus = user.isAdmin;
                }
                
                return matchesSearch && matchesStatus;
            });

            if (filteredUsers.length === 0) {
                usersTableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px 20px; color: #666;">
                            <i class="fas fa-search"></i>
                            <p>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</p>
                        </td>
                    </tr>
                `;
                return;
            }

            usersTableBody.innerHTML = filteredUsers.map(user => {
                const isPasswordVisible = passwordVisibility[user.id] || false;
                const passwordDisplay = isPasswordVisible ? user.password : '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                
                return `
                <tr>
                    <td>${user.id}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.phone || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}</td>
                    <td>${passwordDisplay}</td>
                    <td>
                        <span class="user-status ${getUserStatusClass(user)}">
                            ${getUserStatusText(user)}
                        </span>
                    </td>
                    <td>${new Date(user.createdAt).toLocaleDateString('uk-UA')}</td>
                    <td class="user-actions">
                        ${user.isBlocked ? 
                            `<button class="user-btn unblock" onclick="toggleUserBlock(${user.id})">
                                <i class="fas fa-unlock"></i> –†–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏
                            </button>` :
                            `<button class="user-btn block" onclick="toggleUserBlock(${user.id})">
                                <i class="fas fa-ban"></i> –ó–∞–±–ª–æ–∫—É–≤–∞—Ç–∏
                            </button>`
                        }
                        ${!user.isAdmin ? 
                            `<button class="user-btn admin" onclick="toggleAdminStatus(${user.id})">
                                <i class="fas fa-crown"></i> –ó—Ä–æ–±–∏—Ç–∏ –∞–¥–º—ñ–Ω–æ–º
                            </button>` :
                            `<button class="user-btn admin" onclick="toggleAdminStatus(${user.id})" style="background: #6c757d;">
                                <i class="fas fa-user"></i> –ó–∞–±—Ä–∞—Ç–∏ –ø—Ä–∞–≤–∞
                            </button>`
                        }
                        <button class="user-btn password" onclick="togglePasswordVisibility(${user.id})">
                            <i class="fas ${isPasswordVisible ? 'fa-eye-slash' : 'fa-eye'}"></i> 
                            ${isPasswordVisible ? '–ü—Ä–∏—Ö–æ–≤–∞—Ç–∏' : '–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞—Ä–æ–ª—å'}
                        </button>
                        <button class="user-btn history" onclick="showUserHistory(${user.id})">
                            <i class="fas fa-history"></i> –Ü—Å—Ç–æ—Ä—ñ—è
                        </button>
                    </td>
                </tr>
            `}).join('');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#e53935' : '#007aff'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                z-index: 10000;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                animation: slideInRight 0.3s ease-out;
                display: flex;
                align-items: center;
                gap: 10px;
            `;
            notification.innerHTML = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }

        window.addEventListener('beforeunload', function() {
            if (supportChatInterval) {
                clearInterval(supportChatInterval);
            }
        });

        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from {
                    opacity: 0;
                    transform: translateX(100px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
